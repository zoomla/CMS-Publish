@using System.Text
@using ZoomLa.Common
@using ZoomLa.Model
@using ZoomLa.Components
@using ZoomLa.BLL.Content
@model ZoomLaCMS.Models.Field.VM_FieldModel
@{
    string value = Model.GetValue();
    string Name = Model.fieldMod.FieldName;
    string imgSrc = string.IsNullOrEmpty(value) ? "" : value;
    FieldModel fieldMod = new FieldModel(Model.fieldMod.Content);
    string addon = Model.config.Source == ModelConfig.SType.UserRegister ? "&action=reg" : "";
}
@*@MvcHtmlString.Create(GetPicType())*@
@*<div>
        <div>
            <img id='Img_@Name' src='@imgSrc' class='preview_img' width='150' height='100' onclick='PopImage("popImg","txt_@Name",500, 400);' onerror="this.src='/UploadFiles/nopic.svg';" title='点击查看大图'>
        </div>
        <div class="input-group mb-3" style="margin-top:5px;">
            <input type="text" class="form-control m50rem_50 @(Model.fieldMod.IsNotNull?"required":"")" value="@value" name="txt_@Name" id="txt_@Name">@Model.fieldMod.Description
        </div>



    </div>
    <div style="margin-top:5px;">
        <input type="file" accept="image/*"/>
        <iframe class="field_img_frame" id="Upload_@Name" src="/Common/ContentFile?ModelID=@Model.ModelID&FieldName=@(Name + addon)" style='border:none;width:100%;height:30px;' scrolling="no"></iframe>
    </div>
    <div id='popImg' style='display:none;'>
        <div class='ptitle'><span onclick='javascript: document.getElementById("popImg").style.visibility = "hidden";' title='Close' class='ViewPicClo'> &#x00D7; </span>预览图片  </div>
        <div id='divImage'><img id='imgView' src='#' alt='预览的图片' onload='AutoSetSize(this, 490, 360);' /></div>
    </div>*@

@Html.Partial("C_SFileUP", new C_SFileUP() { ID = Name, SaveType = "admin", Value = imgSrc, FileType = "img", UP_After = "PicType_"+Name+"_UPAfter", AutoUpload = true, Img_Camera = true, Img_Edit = true })
<script>
function PicType_@(Name)_UPAfter(data){
var data=data.replace("/UploadFiles/","");
$("#@(Name)_t").val(data);
}
$(function () {
    $("#@(Name)_img").attr("src","@Html.Raw(function.GetImgUrl(imgSrc))");
})
</script>